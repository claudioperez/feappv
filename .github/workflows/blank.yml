# =================================================================
#   F I N I T E   E L E M E N T   A N A L Y S I S   P R O G R A M
#           (c) Regents of the University of California            
#                        All Rights Reserved.
# =================================================================

name: CI

# Trigger in two scenarios:
# 1) when pushing directly into master, and
# 2) when pull requests are opened on devel
on:
  push:
    branches: [master]

  pull_request:
    branches: [devel]

  workflow_dispatch:


jobs:
  build-linux:
    name: Build Linux
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get install gfortran libopenblas-dev libopenmpi-dev
        echo Finish GFORTRAN install

    - name: Configure and Compile
      run: |
        mkdir build
        cmake -S . -B build
        cmake --build build -j 8

  build-mac:
    name: Build Mac OS
    runs-on: macos-latest
    timeout-minutes: 30

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
         ln -s /opt/homebrew/bin/gcc-13 /usr/local/bin/gcc
         ln -s /opt/homebrew/bin/gfortran-13 /usr/local/bin/gfortran
         brew install open-mpi
         brew install scalapack

      - name: Configure and Compile
        run: |
          mkdir build
          cmake -S . -B build
          cmake --build build

